!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["p5.anaglyph"]=e():t["p5.anaglyph"]=e()}(self,(()=>(()=>{"use strict";var t={};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function i(t,i){for(var r=0;r<i.length;r++){var a=i[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,(void 0,c=function(t,i){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var a=r.call(t,"string");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(a.key),"symbol"===e(c)?c:String(c)),a)}var c}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var r=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.divergence=1,this.swapLeftRight=1,this.adjustTargetFactor=1,this.useAsymmetricFrustum=!0,this.cameraDivergenceX=0,this.cameraDivergenceY=0,this.cameraDivergenceZ=0,this.frustrumSkew=0,this.RAD_TO_DEG=57.29577951308232,this.LEFT_IMG=0,this.RIGHT_IMG=1}var e,r;return e=t,r=[{key:"init",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.theShader=loadShader("./shader/anaglyph.vert","./shader/anaglyph.frag"),this.divergence=t,this.config={cameraPositionX:0,cameraPositionY:0,cameraPositionZ:height/2/tan(PI/6),cameraTargetX:0,cameraTargetY:0,cameraTargetZ:0,cameraUpX:0,cameraUpY:1,cameraUpZ:0,frustumLeft:-width/2,frustumRight:width/2,frustumBottom:-height/2,frustumTop:height/2,frustumNear:0,frustumFar:max(width,height),fovy:PI/3},this.perspective(),this.recalculateCameraSettings(),this.imgLeft=createGraphics(width,height,WEBGL),this.imgRight=createGraphics(width,height,WEBGL)}},{key:"draw",value:function(t){this.theShader?(this.drawSide(this.LEFT_IMG,this.imgLeft,t),this.drawSide(this.RIGHT_IMG,this.imgRight,t),this.theShader.setUniform("u_resolution",[width,height]),this.theShader.setUniform("mapLeft",this.imgLeft),this.theShader.setUniform("mapRight",this.imgRight),shader(this.theShader),rect(0,0,width,height)):(this.drawSide(this.LEFT_IMG,this.imgLeft,t),image(this.imgLeft,-width/2,-height/2))}},{key:"drawSide",value:function(t,e,i){e.push(),e.clear(),this.getCamera(t,e),i(e),e.pop()}},{key:"recalculateCameraSettings",value:function(){var t=this.adjustTargetFactor*(this.config.cameraPositionX-this.config.cameraTargetX),e=this.adjustTargetFactor*(this.config.cameraPositionY-this.config.cameraTargetY),i=this.adjustTargetFactor*(this.config.cameraPositionZ-this.config.cameraTargetZ),r=-this.swapLeftRight*this.divergence/(this.config.fovy*this.RAD_TO_DEG);this.cameraDivergenceX=(e*this.config.cameraUpZ-this.config.cameraUpY*i)*r,this.cameraDivergenceY=(i*this.config.cameraUpX-this.config.cameraUpZ*t)*r,this.cameraDivergenceZ=(t*this.config.cameraUpY-this.config.cameraUpX*e)*r;var a=Math.sqrt(t*t+e*e+i*i),c=Math.sign(this.swapLeftRight*this.divergence)*Math.sqrt(this.cameraDivergenceX*this.cameraDivergenceX+this.cameraDivergenceY*this.cameraDivergenceY+this.cameraDivergenceZ*this.cameraDivergenceZ);this.frustrumSkew=c*this.config.frustumNear/a}},{key:"getCamera",value:function(t,e){this.useAsymmetricFrustum?this.drawAsymmetricFrustrum(t,e):this.drawSymmetricFrustrum(t,e)}},{key:"drawAsymmetricFrustrum",value:function(t,e){t==this.LEFT_IMG?(e.camera(this.config.cameraPositionX+this.cameraDivergenceX,this.config.cameraPositionY+this.cameraDivergenceY,this.config.cameraPositionZ+this.cameraDivergenceZ,this.config.cameraTargetX+this.cameraDivergenceX,this.config.cameraTargetY+this.cameraDivergenceY,this.config.cameraTargetZ+this.cameraDivergenceZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ),e.frustum(this.config.frustumLeft-this.frustrumSkew,this.config.frustumRight-this.frustrumSkew,this.config.frustumBottom,this.config.frustumTop,this.config.frustumNear,this.config.frustumFar)):t==this.RIGHT_IMG&&(e.camera(this.config.cameraPositionX-this.cameraDivergenceX,this.config.cameraPositionY-this.cameraDivergenceY,this.config.cameraPositionZ-this.cameraDivergenceZ,this.config.cameraTargetX-this.cameraDivergenceX,this.config.cameraTargetY-this.cameraDivergenceY,this.config.cameraTargetZ-this.cameraDivergenceZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ),e.frustum(this.config.frustumLeft+this.frustrumSkew,this.config.frustumRight+this.frustrumSkew,this.config.frustumBottom,this.config.frustumTop,this.config.frustumNear,this.config.frustumFar))}},{key:"drawSymmetricFrustrum",value:function(t,e){t==LEFT_IMG?e.camera(this.config.cameraPositionX+this.cameraDivergenceX,this.config.cameraPositionY+this.cameraDivergenceY,this.config.cameraPositionZ+this.cameraDivergenceZ,this.config.cameraTargetX,this.config.cameraTargetY,this.config.cameraTargetZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ):t==this.RIGHT_IMG&&e.camera(this.config.cameraPositionX-this.cameraDivergenceX,this.config.cameraPositionY-this.cameraDivergenceY,this.config.cameraPositionZ-this.cameraDivergenceZ,this.config.cameraTargetX,this.config.cameraTargetY,this.config.cameraTargetZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ)}},{key:"perspective",value:function(){var t=height/2/Math.tan(60*PI/360),e=PI/3,i=width/height,r=t/10,a=10*t,c=r*Math.tan(e/2),s=-c,h=s*i,n=c*i;this.frustum(h,n,s,c,r,a)}},{key:"frustum",value:function(t,e,i,r,a,c){this.config.frustumLeft=t,this.config.frustumRight=e,this.config.frustumBottom=i,this.config.frustumTop=r,this.config.frustumNear=a,this.config.frustumFar=c,this.config.fovy=2*Math.atan(r/a)}}],r&&i(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}());return p5.prototype.createAnaglyph=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return r.init(t),r},p5.prototype.camera=function(){},p5.prototype.frustrum=function(){},t})()));