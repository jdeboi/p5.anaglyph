!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports["p5.anaglyph"]=i():t["p5.anaglyph"]=i()}(self,(()=>(()=>{"use strict";var t={};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function e(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,s=function(t,e){if("object"!==i(t)||null===t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,"string");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===i(s)?s:String(s)),r)}var s}(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var a=new(function(){function t(){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.divergence=1,this.swapLeftRight=1,this.adjustTargetFactor=1,this.useAsymmetricFrustum=!0,this.cameraDivergenceX=0,this.cameraDivergenceY=0,this.cameraDivergenceZ=0,this.frustrumSkew=0,this.RAD_TO_DEG=57.29577951308232,this.LEFT_IMG=0,this.RIGHT_IMG=1,this.shaderLoaded=!1}var i,a;return i=t,a=[{key:"init",value:function(){var t=this,i="https://cdn.jsdelivr.net/gh/jdeboi/p5.anaglyph/src/shader/anaglyph";this.theShader=this.pInst.loadShader(i+".vert",i+".frag",(function(){t.shaderLoaded=!0})),this.config={cameraPositionX:0,cameraPositionY:0,cameraPositionZ:this.pInst.height/2/this.pInst.tan(this.pInst.PI/6),cameraTargetX:0,cameraTargetY:0,cameraTargetZ:0,cameraUpX:0,cameraUpY:1,cameraUpZ:0,frustumLeft:-this.pInst.width/2,frustumRight:this.pInst.width/2,frustumBottom:-this.pInst.height/2,frustumTop:this.pInst.height/2,frustumNear:0,frustumFar:max(this.pInst.width,this.pInst.height),fovy:PI/3},this.recalculateCameraSettings(),this.imgLeft=createGraphics(this.pInst.width,this.pInst.height,WEBGL),this.imgRight=createGraphics(this.pInst.width,this.pInst.height,WEBGL),this.output=createGraphics(this.pInst.width,this.pInst.height,WEBGL)}},{key:"draw",value:function(t){this.theShader&&this.shaderLoaded?(this.drawScene(this.LEFT_IMG,this.imgLeft,t),this.drawScene(this.RIGHT_IMG,this.imgRight,t),this.updateShader()):(this.drawScene(this.LEFT_IMG,this.imgLeft,t),image(this.imgLeft,-this.pInst.width/2,-this.pInst.height/2))}},{key:"setDivergence",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.divergence=t}},{key:"updateShader",value:function(){this.theShader.setUniform("u_resolution",[this.pInst.width,this.pInst.height]),this.theShader.setUniform("mapLeft",this.imgLeft),this.theShader.setUniform("mapRight",this.imgRight),this.output.clear(),this.output.shader(this.theShader),this.output.rect(0,0,this.pInst.width,this.pInst.height),this.pInst.image(this.output,-this.pInst.width/2,-this.pInst.height/2)}},{key:"drawStereoImages",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.theShader&&this.shaderLoaded?(this.drawImage(t,this.imgLeft,e,a),this.drawImage(i,this.imgRight,e,a),this.updateShader()):this.drawImage(t,this.imgLeft)}},{key:"drawImage",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t&&(i.push(),i.clear(),i.translate(e,a),i.scale(1,-1),i.image(t,0,0),i.pop())}},{key:"drawScene",value:function(t,i,e){i.push(),i.clear(),this.getCamera(t,i),e(i),i.pop()}},{key:"recalculateCameraSettings",value:function(){this.perspective();var t=this.adjustTargetFactor*(this.config.cameraPositionX-this.config.cameraTargetX),i=this.adjustTargetFactor*(this.config.cameraPositionY-this.config.cameraTargetY),e=this.adjustTargetFactor*(this.config.cameraPositionZ-this.config.cameraTargetZ),a=-this.swapLeftRight*this.divergence/(this.config.fovy*this.RAD_TO_DEG);this.cameraDivergenceX=(i*this.config.cameraUpZ-this.config.cameraUpY*e)*a,this.cameraDivergenceY=(e*this.config.cameraUpX-this.config.cameraUpZ*t)*a,this.cameraDivergenceZ=(t*this.config.cameraUpY-this.config.cameraUpX*i)*a;var r=Math.sqrt(t*t+i*i+e*e),s=Math.sign(this.swapLeftRight*this.divergence)*Math.sqrt(this.cameraDivergenceX*this.cameraDivergenceX+this.cameraDivergenceY*this.cameraDivergenceY+this.cameraDivergenceZ*this.cameraDivergenceZ);this.frustrumSkew=s*this.config.frustumNear/r}},{key:"getCamera",value:function(t,i){this.useAsymmetricFrustum?this.drawAsymmetricFrustrum(t,i):this.drawSymmetricFrustrum(t,i)}},{key:"drawAsymmetricFrustrum",value:function(t,i){t==this.LEFT_IMG?(i.camera(this.config.cameraPositionX+this.cameraDivergenceX,this.config.cameraPositionY+this.cameraDivergenceY,this.config.cameraPositionZ+this.cameraDivergenceZ,this.config.cameraTargetX+this.cameraDivergenceX,this.config.cameraTargetY+this.cameraDivergenceY,this.config.cameraTargetZ+this.cameraDivergenceZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ),i.frustum(this.config.frustumLeft-this.frustrumSkew,this.config.frustumRight-this.frustrumSkew,this.config.frustumBottom,this.config.frustumTop,this.config.frustumNear,this.config.frustumFar)):t==this.RIGHT_IMG&&(i.camera(this.config.cameraPositionX-this.cameraDivergenceX,this.config.cameraPositionY-this.cameraDivergenceY,this.config.cameraPositionZ-this.cameraDivergenceZ,this.config.cameraTargetX-this.cameraDivergenceX,this.config.cameraTargetY-this.cameraDivergenceY,this.config.cameraTargetZ-this.cameraDivergenceZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ),i.frustum(this.config.frustumLeft+this.frustrumSkew,this.config.frustumRight+this.frustrumSkew,this.config.frustumBottom,this.config.frustumTop,this.config.frustumNear,this.config.frustumFar))}},{key:"drawSymmetricFrustrum",value:function(t,i){t==LEFT_IMG?i.camera(this.config.cameraPositionX+this.cameraDivergenceX,this.config.cameraPositionY+this.cameraDivergenceY,this.config.cameraPositionZ+this.cameraDivergenceZ,this.config.cameraTargetX,this.config.cameraTargetY,this.config.cameraTargetZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ):t==this.RIGHT_IMG&&i.camera(this.config.cameraPositionX-this.cameraDivergenceX,this.config.cameraPositionY-this.cameraDivergenceY,this.config.cameraPositionZ-this.cameraDivergenceZ,this.config.cameraTargetX,this.config.cameraTargetY,this.config.cameraTargetZ,this.config.cameraUpX,this.config.cameraUpY,this.config.cameraUpZ)}},{key:"perspective",value:function(){var t=this.pInst.height/2/Math.tan(60*PI/360),i=PI/3,e=this.pInst.width/this.pInst.height,a=t/10,r=10*t,s=a*Math.tan(i/2),h=-s,n=h*e,c=s*e;this.frustum(n,c,h,s,a,r)}},{key:"frustum",value:function(t,i,e,a,r,s){this.config.frustumLeft=t,this.config.frustumRight=i,this.config.frustumBottom=e,this.config.frustumTop=a,this.config.frustumNear=r,this.config.frustumFar=s,this.config.fovy=2*Math.atan(a/r)}},{key:"resize",value:function(){this.recalculateCameraSettings()}}],a&&e(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),t}());return p5.prototype.createAnaglyph=function(t){return a.pInst=t,a.init(),a},t})()));